import { Callout, Steps } from "nextra/components";

##  Cron Job / Schedule Job ржХрзА?

**Cron Job** рж╣рж▓рзЛ ржПржХ ржзрж░ржирзЗрж░ **task scheduler** ржмрж╛ рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯ ржХрж╛ржЬрзЗрж░ рж╕рж┐рж╕рзНржЯрзЗржоред
ржорж╛ржирзЗ ржЖржкржирж┐ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржПржХржЯрж╛ ржХржорж╛ржирзНржб ржмрж╛ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж▓рж┐ржЦрзЗ рж░рж╛ржЦржмрзЗржи, ржпрзЗржЯрж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╕ржорзЯ ржкрж░ржкрж░ ржмрж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╕ржорзЯрзЗ ржЕржЯрзЛ ржЪрж╛рж▓рзБ рж╣ржмрзЗред

 ржЙржжрж╛рж╣рж░ржг:

* ржкрзНрж░рждрж┐ рж░рж╛ржд рззрзиржЯрж╛рзЯ ржбрж╛ржЯрж╛ржмрзЗржЬ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛ред
* ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ ржПржХржЯрж╛ API call ржХрж░рж╛ред
* ржкрзНрж░рждрж┐ рж╕рзЛржоржмрж╛рж░ рж╕ржХрж╛рж▓рзЗ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯржХрзЗ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржирзЛред

ржПржЗ ржХрж╛ржЬржЧрзБрж▓рзЛ ржЖржкржирж╛ржХрзЗ ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛ред Cron ржПржЧрзБрж▓рзЛ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржХрж░рзЗ ржжрзЗржмрзЗред

---

## Cron Job ржПрж░ ржХрж╛ржЬ ржХрзАржнрж╛ржмрзЗ рж╣рзЯ?

Linux/Unix рж╕рж┐рж╕рзНржЯрзЗржорзЗ ржПржХржЯрж╛ **cron daemon (crond)** ржЪрж▓рзЗ, ржпрзЗржЯрж╛ рж╕ржмрж╕ржорзЯ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржерж╛ржХрзЗред
ржПржЯрж╛ ржжрзЗржЦрзЗ рж░рж╛ржЦрзЗ ржХрзЗ ржХржЦржи ржХрзЛржи ржХрж╛ржЬ рж░рж╛ржи ржХрж░рж╛ржмрзЗред
ржЖржкржирж┐ ржпрзЗрж╕ржм schedule рж▓рж┐ржЦрзЗ ржжрзЗржи, рж╕рзЗржЧрзБрж▓рзЛ `crontab` ржлрж╛ржЗрж▓рзЗ ржерж╛ржХрзЗред

---

##  Crontab ржХрж┐?

**Crontab (cron table)** рж╣рж▓рзЛ рж╕рзЗржЗ configuration ржлрж╛ржЗрж▓ ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж┐ рж▓рж┐ржЦрзЗ рж░рж╛ржЦржмрзЗржи ржХрзЛржи ржХрж╛ржЬ ржХржЦржи ржЪрж▓ржмрзЗред
ржЖржкржирж┐ `crontab -e` ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ ржПржЯрж╛ ржПржбрж┐ржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред 

---

## Cron Job Syntax

```
* * * * * command_to_execute
- - - - -
| | | | |
| | | | +----- рж╕ржкрзНрждрж╛рж╣рзЗрж░ ржжрж┐ржи (0 - 7) [Sunday = 0 or 7]
| | | +------- ржорж╛рж╕ (1 - 12)
| | +--------- ржорж╛рж╕рзЗрж░ ржжрж┐ржи (1 - 31)
| +----------- ржШржгрзНржЯрж╛ (0 - 23)
+------------- ржорж┐ржирж┐ржЯ (0 - 59)
```

## Cron Expression Example (Cheat Sheet)

* `* * * * *` тЖТ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ
* `*/5 * * * *` тЖТ ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ
* `0 * * * *` тЖТ ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рзЯ
* `0 0 * * *` тЖТ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ
* `0 9 * * 1` тЖТ ржкрзНрж░рждрж┐ рж╕рзЛржоржмрж╛рж░ рж╕ржХрж╛рж▓ рзпржЯрж╛рзЯ

---

##  ржЙржжрж╛рж╣рж░ржг

1. **ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ ржХрж╛ржЬ ржЪрж╛рж▓рж╛ржирзЛ**

```
* * * * * echo "Hello World"
```

2. **ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рзЯ ржХрж╛ржЬ ржЪрж╛рж▓рж╛ржирзЛ**

```
0 * * * * /path/to/script.sh
```

3. **ржкрзНрж░рждрж┐ рж░рж╛ржд рззрзиржЯрж╛рзЯ ржХрж╛ржЬ ржЪрж╛рж▓рж╛ржирзЛ**

```
0 0 * * * /usr/bin/python3 /home/user/backup.py
```

4. **ржкрзНрж░рждрж┐ рж╕рзЛржоржмрж╛рж░ рж╕ржХрж╛рж▓ рзпржЯрж╛рзЯ ржХрж╛ржЬ ржЪрж╛рж▓рж╛ржирзЛ**

```
0 9 * * 1 /path/to/send_report.sh
```

5. **ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ ржХрж╛ржЬ ржЪрж╛рж▓рж╛ржирзЛ**

```
*/5 * * * * /path/to/your/command
```

---

## Cron Job ржПрж░ ржмрзНржпржмрж╣рж╛рж░

* тЬЕ ржбрж╛ржЯрж╛ржмрзЗржЬ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛
* тЬЕ ржЗржорзЗржЗрж▓/ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи ржкрж╛ржарж╛ржирзЛ
* тЬЕ рж▓ржЧ ржлрж╛ржЗрж▓ ржорзБржЫрзЗ ржлрзЗрж▓рж╛
* тЬЕ API / ржбрзЗржЯрж╛ ржлрзЗржЪ ржХрж░рж╛
* тЬЕ рж░рж┐ржкрзЛрж░рзНржЯ ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рж╛

---

##  Cron Job Check ржХрж░рж╛рж░ ржХржорж╛ржирзНржб

* `crontab -l` тЖТ рж╕ржм cron jobs рж▓рж┐рж╕рзНржЯ ржжрзЗржЦрж╛ржмрзЗ
* `crontab -e` тЖТ ржирждрзБржи job ржПржб ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ
* `systemctl status cron` ржмрж╛ `service cron status` тЖТ cron рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж▓ржЫрзЗ ржХрж┐ржирж╛

---

##  Cron Job ржПржмржВ Scheduler ржкрж╛рж░рзНржержХрзНржп

* **Cron Job** тЖТ рж╕рж╛ржзрж╛рж░ржгржд Linux/Unix server ржП ржЪрж▓рзЗред
* **Scheduler (like Node.js, Laravel, NestJS, Django Celery ржЗрждрзНржпрж╛ржжрж┐)** тЖТ ржПрж░рж╛ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж▓рзЗржнрзЗрж▓рзЗрж░ Schedulerред
  ржПржЧрзБрж▓рзЛржУ ржПржХржЗржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ, ржХрж┐ржирзНрждрзБ ржПрж░рж╛ ржХрзЛржб рж▓рзЗржнрзЗрж▓рзЗ schedule ржорзНржпрж╛ржирзЗржЬ ржХрж░рзЗред

---

рждрж╛ржЗ ржпржжрж┐ ржЖржкржирж┐ server-side automation ржХрж░рждрзЗ ржЪрж╛ржи, рждрж╛рж╣рж▓рзЗ Cron Job ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред 
ржЖрж░ ржпржжрж┐ framework ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи  (Node.js, Laravel, NestJS), рждрж╛рж╣рж▓рзЗ framework ржПрж░ built-in scheduler ржУ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред 

---

## Cron/Sheduler With Express Js

ржЖржкржирж┐ ржпржжрж┐ **Express.js (Node.js)** ржжрж┐рзЯрзЗ Scheduler ржмрж╛ржирж╛рждрзЗ ржЪрж╛ржи, рждржЦржи рж╕рж░рж╛рж╕рж░рж┐ Express ржХрж┐ржЫрзБ ржжрзЗрзЯ ржирж╛ред рждржмрзЗ ржЖржорж░рж╛ **Node Scheduler рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

рж╕ржмржЪрзЗрзЯрзЗ ржЬржиржкрзНрж░рж┐рзЯ рж╣ржЪрзНржЫрзЗ  **node-cron** ржЕржержмрж╛ **node-schedule**

ржЪрж▓рзБржи ржЖржорж░рж╛ рж╕рзНржЯрзЗржк ржмрж╛ржЗ рж╕рзНржЯрзЗржк ржжрзЗржЦрж┐ред 

---

<Steps>
### Step 1: Express ржкрзНрж░ржЬрзЗржХрзНржЯ ржмрж╛ржирж╛ржи

```bash
mkdir express-cron-example
cd express-cron-example
npm init -y
npm install express node-cron
```

---

### Step 2: `server.js` ржлрж╛ржЗрж▓ ржмрж╛ржирж╛ржи

```js {2,12-24}
import express from "express";
import cron from "node-cron";

const app = express();
const PORT = 3000;

// Simple route
app.get("/", (req, res) => {
  res.send("Cron Job Example Running!");
});

// тЬЕ Cron Job Example: ржкрзНрж░рждрж┐ 5 ржорж┐ржирж┐ржЯрзЗ ржХржирж╕рзЛрж▓рзЗ ржорзЗрж╕рзЗржЬ ржжрзЗржЦрж╛ржмрзЗ
cron.schedule("*/5 * * * *", () => {
  console.log("тП░ This task runs every 5 minutes");
});

// тЬЕ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд 12 ржЯрж╛рзЯ ржХрж╛ржЬ ржЪрж▓ржмрзЗ
cron.schedule("0 0 * * *", () => {
  console.log("ЁЯУж Daily backup job running at midnight...");
});

app.listen(PORT, () => {
  console.log(`ЁЯЪА Server running on http://localhost:${PORT}`);
});
```

---

###  Step 3: Run ржХрж░рзЗржи 

```bash
node server.js
```

* ржЖржкржирж┐ Express рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржХрж░рзЗ рж░рж╛ржЦрзЗржи
* Cron job ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЪрж▓ржмрзЗред

---

</Steps>



## Practical Example (API call)

ржзрж░рж╛ ржпрж╛ржХ, ржЖржкржирж┐ ржкрзНрж░рждрж┐ рззрзж ржорж┐ржирж┐ржЯрзЗ ржПржХржЯрж╛ API call ржХрж░рждрзЗ ржЪрж╛ржи:

```js
import fetch from "node-fetch";
import cron from "node-cron";

cron.schedule("*/10 * * * *", async () => {
  const res = await fetch("https://jsonplaceholder.typicode.com/todos/1");
  const data = await res.json();
  console.log("Fetched Data:", data);
});
```

---

ржПржнрж╛ржмрзЗ ржЖржкржирж┐ Express.js рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗ ржпржд ржЗржЪрзНржЫрж╛ scheduled task ржмрж╛ржирж╛рждрзЗ ржкрж╛рж░ржмрзЗржиред

---

## Cron/Scheduler with NestJS

NestJS ржП scheduler ржмрж╛ржирж╛ржирзЛ **Express ржерзЗржХрзЗ ржЕржирзЗржХ рж╕рж╣ржЬ** ржХрж╛рж░ржг NestJS ржПрж░ ржЬржирзНржп ржЕржлрж┐рж╕рж┐рзЯрж╛рж▓ржнрж╛ржмрзЗ ржПржХржЯрж╛ ржкрзНржпрж╛ржХрзЗржЬ ржЖржЫрзЗ  **@nestjs/schedule**

ржЪрж▓рзБржи рж╕рзНржЯрзЗржк ржмрж╛ржЗ рж╕рзНржЯрзЗржк ржжрзЗржЦрж┐ржГ 

---
<Steps>

###  Step 1: ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗржи

```bash
npm install --save @nestjs/schedule
npm install --save-dev @types/cron
```

---

###  Step 2: `AppModule` ржП Import ржХрж░рзЗржи 

```ts
// app.module.ts
import { Module } from '@nestjs/common';
import { ScheduleModule } from '@nestjs/schedule';
import { TasksModule } from './tasks/tasks.module';

@Module({
  imports: [
    ScheduleModule.forRoot(), // тЬЕ Scheduler enable ржХрж░рж╛ рж╣рж▓рзЛ
    TasksModule,
  ],
})
export class AppModule {}
```

---

###  Step 3: Task Module ржмрж╛ржирж╛ржи

```bash
nest g module tasks
nest g service tasks
```

---

###  Step 4: Scheduler рж▓рж┐ржЦрзЗржи 

```ts
// tasks.service.ts
import { Injectable, Logger } from '@nestjs/common';
import { Cron, Interval, Timeout } from '@nestjs/schedule';

@Injectable()
export class TasksService {
  private readonly logger = new Logger(TasksService.name);

  // тЬЕ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ ржХрж╛ржЬ ржЪрж▓ржмрзЗ
  @Cron('* * * * *')
  handleCron() {
    this.logger.debug('тП░ Called every minute');
  }

  // тЬЕ ржкрзНрж░рждрж┐ 10 рж╕рзЗржХрзЗржирзНржбрзЗ ржХрж╛ржЬ ржЪрж▓ржмрзЗ
  @Interval(10000)
  handleInterval() {
    this.logger.debug('тЪб Called every 10 seconds');
  }

  // тЬЕ ржЕрзНржпрж╛ржк рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржУрзЯрж╛рж░ 5 рж╕рзЗржХрзЗржирзНржб ржкрж░рзЗ ржПржХржмрж╛рж░ ржЪрж▓ржмрзЗ
  @Timeout(5000)
  handleTimeout() {
    this.logger.debug('ЁЯЪА Called once after 5 seconds');
  }
}
```

---

###  Step 5: Run ржХрж░рзЗржи

```bash
npm run start:dev
```

Console ржП ржжрзЗржЦржмрзЗ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ/рззрзж рж╕рзЗржХрзЗржирзНржбрзЗ рж▓ржЧ ржкрзНрж░рж┐ржирзНржЯ рж╣ржЪрзНржЫрзЗред 

---

</Steps>


## Cron Expression Example (NestJS ржПржУ ржПржХржЗ)

* `* * * * *` тЖТ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ
* `*/5 * * * *` тЖТ ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ
* `0 * * * *` тЖТ ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рзЯ
* `0 0 * * *` тЖТ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ
* `0 9 * * 1` тЖТ ржкрзНрж░рждрж┐ рж╕рзЛржоржмрж╛рж░ рж╕ржХрж╛рж▓ рзпржЯрж╛рзЯ

---
 NestJS ржП @nestjs/schedule ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржХрзЛржб **structured** ржерж╛ржХрзЗ, ржПржмржВ Cron / Interval / Timeout рж╕ржмржХрж┐ржЫрзБ ржбрзЗржХрзЛрж░рзЗржЯрж░ ржжрж┐рзЯрзЗ рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ ржпрж╛рзЯред

---

## Practical Example 

ржЪрж▓рзЗржи ржПржХржЯрж╛ **Practical NestJS Scheduler Example** ржжрзЗржЦрж┐ тАФ
ржпрзЗржЦрж╛ржирзЗ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ ржбрж╛ржЯрж╛ржмрзЗржЬ ржмрзНржпрж╛ржХржЖржк рж╣ржмрзЗ ржЖрж░ ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ Stripe ржПрж░ API hit рж╣ржмрзЗред

---
<Steps>
### Step 1: Install dependency


```bash
npm install --save @nestjs/schedule
npm install --save-dev @types/cron
```

---

### Step 2: `AppModule` ржП ScheduleModule ржпрзЛржЧ ржХрж░рзЗржи

```ts
// app.module.ts
import { Module } from '@nestjs/common';
import { ScheduleModule } from '@nestjs/schedule';
import { TasksModule } from './tasks/tasks.module';

@Module({
  imports: [
    ScheduleModule.forRoot(),
    TasksModule, // ЁЯСИ ржЖржорж╛ржжрзЗрж░ scheduler task module
  ],
})
export class AppModule {}
```

---

###  Step 3: Task Module + Service ржмрж╛ржирж╛ржи 

```bash
nest g module tasks
nest g service tasks
```

---

###  Step 4: Task Service рж▓рж┐ржЦрзЗржи 

```ts
// tasks.service.ts
import { Injectable, Logger } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import fetch from 'node-fetch';

@Injectable()
export class TasksService {
  private readonly logger = new Logger(TasksService.name);

  // тЬЕ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛
  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)
  async handleDatabaseBackup() {
    this.logger.debug('ЁЯУж Starting daily database backup...');
    // ржПржЦрж╛ржирзЗ ржЖржкржирж╛рж░ DB backup logic ржмрж╕рж╛ржмрзЗ
    // ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛
    // fs.writeFileSync(`/backups/db-${Date.now()}.sql`, dbDump);
    this.logger.debug('тЬЕ Database backup completed!');
  }

  // тЬЕ ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ Stripe API hit ржХрж░рж╛
  @Cron('*/5 * * * *')
  async handleStripeCheck() {
    this.logger.debug('ЁЯТ│ Checking Stripe API...');
    try {
      const res = await fetch('https://api.stripe.com/v1/charges', {
        headers: {
          Authorization: `Bearer ${process.env.STRIPE_SECRET_KEY}`, // ржЖржкржирж╛рж░ secret key env ржерзЗржХрзЗ ржирзЗржмрзЗ
        },
      });
      const data = await res.json();
      this.logger.debug(`тЬЕ Stripe data fetched. Found ${data.data?.length || 0} charges`);
    } catch (err) {
      this.logger.error('тЭМ Stripe API call failed', err.message);
    }
  }
}
```

---

###  Step 5: Run ржХрж░рзЗржи 

```bash
npm run start:dev
```

* ржкрзНрж░рждрж┐ рж░рж╛ржд рззрзиржЯрж╛рзЯ backup log ржЖрж╕ржмрзЗред
* ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ Stripe API hit рж╣ржмрзЗред

---
</Steps>


##  Common CronExpression (NestJS built-in)

NestJS ржХрж┐ржЫрзБ ready expression ржжрзЗрзЯ:

* `CronExpression.EVERY_MINUTE` тЖТ ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ
* `CronExpression.EVERY_5_MINUTES` тЖТ ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ
* `CronExpression.EVERY_DAY_AT_MIDNIGHT` тЖТ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ
* `CronExpression.EVERY_HOUR` тЖТ ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рзЯ


---

### ржЪрж▓рзБржи ржжрзЗржЦрж┐ **ржХрзАржнрж╛ржмрзЗ ржбрж╛ржЯрж╛ржмрзЗржЬ ржмрзНржпрж╛ржХржЖржк (MySQL ржмрж╛ Postgres) NestJS scheduler ржжрж┐рзЯрзЗ ржлрж╛ржЗрж▓ ржЖржХрж╛рж░рзЗ рж╕рзЗржн ржХрж░рж╛ ржпрж╛рзЯ**? 


###  Concept

1. ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ (cron job) **backup command** рж░рж╛ржи ржХрж░ржмрзЗред
2. ржПржЗ command `mysqldump` (MySQL ржПрж░ ржЬржирзНржп) ржЕржержмрж╛ `pg_dump` (Postgres ржПрж░ ржЬржирзНржп) ржЗржЙржЬ ржХрж░рзЗ `.sql` ржлрж╛ржЗрж▓ ржмрж╛ржирж╛ржмрзЗред
3. ржлрж╛ржЗрж▓ `/backups` ржлрзЛрж▓рзНржбрж╛рж░рзЗ рж╕рзЗржн рж╣ржмрзЗред

---

<Steps> 

###  Step 1: Install extra packages

```bash
npm install --save @nestjs/schedule
npm install --save-dev @types/cron
```

---

### Step 2: AppModule

```ts
// app.module.ts
import { Module } from '@nestjs/common';
import { ScheduleModule } from '@nestjs/schedule';
import { TasksModule } from './tasks/tasks.module';

@Module({
  imports: [
    ScheduleModule.forRoot(),
    TasksModule,
  ],
})
export class AppModule {}
```

---

### Step 3: Task Service

ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ **child\_process** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм ржХржорж╛ржирзНржб рж░рж╛ржи ржХрж░рж╛рж░ ржЬржирзНржпред

```ts
// tasks.service.ts
import { Injectable, Logger } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import { exec } from 'child_process';
import * as fs from 'fs';
import * as path from 'path';

@Injectable()
export class TasksService {
  private readonly logger = new Logger(TasksService.name);

  // тЬЕ ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ ржбрж╛ржЯрж╛ржмрзЗржЬ ржмрзНржпрж╛ржХржЖржк ржирзЗржмрзЗ
  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)
  async handleDatabaseBackup() {
    this.logger.debug('ЁЯУж Starting daily database backup...');

    const backupDir = path.join(__dirname, '..', '..', 'backups');
    if (!fs.existsSync(backupDir)) {
      fs.mkdirSync(backupDir);
    }

    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupFile = path.join(backupDir, `backup-${timestamp}.sql`);

    // ЁЯСЙ ржпржжрж┐ MySQL рж╣рзЯ
    const mysqlCommand = `mysqldump -u ${process.env.DB_USER} -p${process.env.DB_PASSWORD} ${process.env.DB_NAME} > ${backupFile}`;

    // ЁЯСЙ ржпржжрж┐ Postgres рж╣рзЯ (comment/uncomment ржХрж░рзЗ ржирзЗржи)
    // const mysqlCommand = `PGPASSWORD=${process.env.DB_PASSWORD} pg_dump -U ${process.env.DB_USER} -h ${process.env.DB_HOST} ${process.env.DB_NAME} > ${backupFile}`;

    exec(mysqlCommand, (error, stdout, stderr) => {
      if (error) {
        this.logger.error(`тЭМ Backup failed: ${error.message}`);
        return;
      }
      if (stderr) {
        this.logger.warn(`тЪая╕П Backup warning: ${stderr}`);
      }
      this.logger.debug(`тЬЕ Backup saved to: ${backupFile}`);
    });
  }
}
```

---

###  Step 4: .env ржлрж╛ржЗрж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗржЬ ржХржиржлрж┐ржЧ рж░рж╛ржЦрзЗржи

```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=secret
DB_NAME=mydatabase
```

---

###  Step 5: Run ржХрж░рзЗржи 

```bash
npm run start:dev
```

ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ `/backups/backup-2025-08-20-00-00-00.sql` ржПрж░ ржорждрзЛ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ рж╣ржмрзЗред

---

</Steps>

### ржЪрж▓рзЗржи ржжрзЗржЦрж┐ **ржХрж┐ржнрж╛ржмрзЗ ржПржЗ backup ржлрж╛ржЗрж▓ AWS S3 ржП ржЕржЯрзЛ-ржЖржкрж▓рзЛржб ржХрж░рж╛ ржпрж╛рзЯ** (cron job ржПрж░ ржнрзЗрждрж░рзЗржЗ)?


---
<Steps> 
###  Step 1: Install AWS SDK

```bash
npm install @aws-sdk/client-s3
```

---

###  Step 2: .env ржП S3 Credentials рж░рж╛ржЦрзЗржи

```env
AWS_REGION=ap-south-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_BUCKET_NAME=my-db-backups
```

---

### Step 3: Task Service ржЖржкржбрзЗржЯ ржХрж░рзЗржи 

```ts
// tasks.service.ts
import { Injectable, Logger } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import { exec } from 'child_process';
import * as fs from 'fs';
import * as path from 'path';
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';

@Injectable()
export class TasksService {
  private readonly logger = new Logger(TasksService.name);

  private s3 = new S3Client({
    region: process.env.AWS_REGION,
    credentials: {
      accessKeyId: process.env.AWS_ACCESS_KEY_ID,
      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,
    },
  });

  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)
  async handleDatabaseBackup() {
    this.logger.debug('ЁЯУж Starting daily database backup...');

    const backupDir = path.join(__dirname, '..', '..', 'backups');
    if (!fs.existsSync(backupDir)) {
      fs.mkdirSync(backupDir);
    }

    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupFile = path.join(backupDir, `backup-${timestamp}.sql`);

    // ЁЯСЙ MySQL Backup Command
    const backupCommand = `mysqldump -u ${process.env.DB_USER} -p${process.env.DB_PASSWORD} ${process.env.DB_NAME} > ${backupFile}`;

    exec(backupCommand, async (error, stdout, stderr) => {
      if (error) {
        this.logger.error(`тЭМ Backup failed: ${error.message}`);
        return;
      }
      if (stderr) {
        this.logger.warn(`тЪая╕П Backup warning: ${stderr}`);
      }

      this.logger.debug(`тЬЕ Backup saved locally: ${backupFile}`);

      // ЁЯУд Upload to AWS S3
      try {
        const fileStream = fs.createReadStream(backupFile);

        const uploadParams = {
          Bucket: process.env.AWS_BUCKET_NAME,
          Key: `db-backups/backup-${timestamp}.sql`, // ржлрзЛрж▓рзНржбрж╛рж░ рж╕рж╣ ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо
          Body: fileStream,
        };

        await this.s3.send(new PutObjectCommand(uploadParams));

        this.logger.debug(`тШБя╕П Backup uploaded to S3: backup-${timestamp}.sql`);
      } catch (err) {
        this.logger.error('тЭМ S3 Upload Failed', err.message);
      }
    });
  }
}
```

---

###  Step 4: Run ржХрж░рзЗржи 

```bash
npm run start:dev
```

* ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛рзЯ backup ржлрж╛ржЗрж▓ рждрзИрж░рж┐ рж╣ржмрзЗред
* рждрж╛рж░ржкрж░ ржЕржЯрзЛржорзЗржЯрж┐ржХржнрж╛ржмрзЗ AWS S3 рждрзЗ ржЖржкрж▓рзЛржб рж╣рзЯрзЗ ржпрж╛ржмрзЗ `db-backups/backup-xxxx.sql` ржирж╛ржорзЗред

---
</Steps>

###